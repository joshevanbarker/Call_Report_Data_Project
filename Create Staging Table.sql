-- Josh Barker 
-- Call Report Data Project

-- Staging Table for FFIEC CDR Call Report Data and Load Data
--Works with direct download from CDR "Call Reports -- Balance Sheet, Income Statement, Past Due -- Four Periods"

DROP TABLE IF EXISTS raw_call_data_part_1;
DROP TABLE IF EXISTS raw_call_data_part_2;

CREATE TABLE raw_call_data_part_1(
As_Of_DT DATE NOT NULL,
ID_RSSD VARCHAR(8) NOT NULL,
FDIC_Certificate VARCHAR(8),
OCC_Charter VARCHAR(8),
OTS_Docket VARCHAR(8),
Routing_Number VARCHAR(9),
Inst_Name VARCHAR(255),
Inst_Address VARCHAR(255),
Inst_City VARCHAR(255), 
Inst_State CHAR(2),
Inst_Zip VARCHAR(9),
Filing_Type VARCHAR(5),
Submission_D_DT TIMESTAMP,
RCFD0071 int,
RCFD0081 int,
RCFD1248 int,
RCFD1249 int,
RCFD1250 int,
RCFD1251 int,
RCFD1252 int,
RCFD1253 int,
RCFD1254 int,
RCFD1255 int,
RCFD1256 int,
RCFD1403 int,
RCFD1406 int,
RCFD1407 int,
RCFD1583 int,
RCFD1594 int,
RCFD1597 int,
RCFD1773 int,
RCFD2130 int,
RCFD2143 int,
RCFD2145 int,
RCFD2150 int,
RCFD2160 int,
RCFD2170 BIGINT,
RCFD2930 int,
RCFD2948 BIGINT,
RCFD3000 int,
RCFD3123 int,
RCFD3190 int,
RCFD3200 int,
RCFD3210 int,
RCFD3230 int,
RCFD3300 BIGINT,
RCFD3505 int,
RCFD3506 int,
RCFD3507 int,
RCFD3529 int,
RCFD3530 int,
RCFD3545 int,
RCFD3548 int,
RCFD3632 int,
RCFD3656 int,
RCFD3838 int,
RCFD3839 int,
RCFD5369 int,
RCFD5377 int,
RCFD5378 int,
RCFD5379 int,
RCFD5380 int,
RCFD5381 int,
RCFD5382 int,
RCFD5389 int,
RCFD5390 int,
RCFD5391 int,
RCFD5459 int,
RCFD5460 int,
RCFD5461 int,
RCFD6558 int,
RCFD6559 int,
RCFD6560 int,
RCFD6724 varchar(2),
RCFDA130 int,
RCFDB528 int,
RCFDB529 int,
RCFDB530 int,
RCFDB575 int,
RCFDB576 int,
RCFDB577 int,
RCFDB989 int,
RCFDB995 int,
RCFDC226 int,
RCFDC240 int,
RCFDC241 int,
RCFDC410 int,
RCFDC411 int,
RCFDF166 int,
RCFDF167 int,
RCFDF168 int,
RCFDF169 int,
RCFDF170 int,
RCFDF171 int,
RCFDG105 int,
RCFDHK26 int,
RCFDHK27 int,
RCFDHK28 int,
RCFDJA22 int,
RCFDJJ34 int,
RCFDK036 int,
RCFDK037 int,
RCFDK038 int,
RCFDK039 int,
RCFDK040 int,
RCFDK041 int,
RCFDK042 int,
RCFDK043 int,
RCFDK044 int,
RCFDK087 int,
RCFDK088 int,
RCFDK089 int,
RCFDK102 int,
RCFDK103 int,
RCFDK104 int,
RCFDK120 int,
RCFDK121 int,
RCFDK122 int,
RCFDK123 int,
RCFDK124 int,
RCFDK125 int,
RCFDK126 int,
RCFDK127 int,
RCFDK128 int,
RCFDK138 int,
RCFDK139 int,
RCFDK140 int,
RCFDK213 int,
RCFDK214 int,
RCFDK215 int,
RCFDK216 int,
RCFDK217 int,
RCFDK218 int,
RCFDK274 int,
RCFDK275 int,
RCFDK276 int,
RCFDK277 int,
RCFDK278 int,
RCFDK279 int,
RCFDK280 int,
RCFDK281 int,
RCFDK282 int,
RCFDL183 int,
RCFDL184 int,
RCFDL185 int,
RCFDL186 int,
RCFDL187 int,
RCFDL188 int,
RCFN2200 int,
RCFN6631 int,
RCFN6636 int,
RCFNB572 int,
RCFNB573 int,
RCFNB574 int,
RCON0071 int,
RCON0081 int,
RCON1226 int,
RCON1227 int,
RCON1228 int,
RCON1248 int,
RCON1249 int,
RCON1250 int,
RCON1254 int,
RCON1255 int,
RCON1256 int,
RCON1403 int,
RCON1406 int,
RCON1407 int,
RCON1583 int,
RCON1594 int,
RCON1597 int,
RCON1606 int,
RCON1607 int,
RCON1608 int,
RCON1773 int,
RCON2130 int,
RCON2143 int,
RCON2145 int,
RCON2150 int,
RCON2160 int,
RCON2170 int,
RCON2200 BIGINT,
RCON2930 int,
RCON2948 int,
RCON3000 int,
RCON3123 int,
RCON3190 int,
RCON3200 int,
RCON3210 int,
RCON3230 int,
RCON3300 int,
RCON3493 int,
RCON3494 int,
RCON3495 int,
RCON3499 int,
RCON3500 int,
RCON3501 int,
RCON3505 int,
RCON3506 int,
RCON3507 int,
RCON3545 int,
RCON3548 int,
RCON3632 int,
RCON3656 int,
RCON3838 int,
RCON3839 int,
RCON5369 int,
RCON5380 int,
RCON5381 int,
RCON5382 int,
RCON5398 int,
RCON5399 int,
RCON5400 int,
RCON5459 int,
RCON5460 int,
RCON5461 int,
RCON6558 int,
RCON6559 int,
RCON6560 int,
RCON6631 int,
RCON6636 int,
RCON6724 varchar(2),
RCON8678 int,
RCONA130 int,
RCONB528 int,
RCONB529 int,
RCONB530 int,
RCONB575 int,
RCONB576 int,
RCONB577 int,
RCONB834 int,
RCONB835 int,
RCONB836 int,
RCONB987 int,
RCONB989 int,
RCONB993 int,
RCONB995 int,
RCONC226 int,
RCONC229 int,
RCONC230 int,
RCONC236 int,
RCONC237 int,
RCONC238 int,
RCONC239 int,
RCONC240 int,
RCONC241 int,
RCONC410 int,
RCONC411 int,
RCONF166 int,
RCONF167 int,
RCONF168 int,
RCONF172 int,
RCONF173 int,
Primary Key(As_Of_DT, ID_RSSD) 
);

CREATE TABLE raw_call_data_part_2 (
As_Of_DT DATE NOT NULL,
ID_RSSD VARCHAR(8) NOT NULL,
FDIC_Certificate VARCHAR(8),
OCC_Charter VARCHAR(8),
OTS_Docket VARCHAR(8),
Routing_Number VARCHAR(9),
Inst_Name VARCHAR(255),
Inst_Address VARCHAR(255),
Inst_City VARCHAR(255), 
Inst_State CHAR(2),
Inst_Zip VARCHAR(9),
Filing_Type VARCHAR(5),
Submission_D_DT TIMESTAMP,
RCONF174 INT,
RCONF175 INT,
RCONF176 INT,
RCONF177 INT,
RCONF178 INT,
RCONF179 INT,
RCONF180 INT,
RCONF181 INT,
RCONF182 INT, 
RCONF183 INT, 
RCONF661 INT, 
RCONF662 INT, 
RCONF663 INT, 
RCONG105 INT,
RCONHK26 INT,
RCONHK27 INT,
RCONHK28 INT,
RCONJA22 INT,
RCONJJ34 INT,
RCONK036 INT,
RCONK037 INT,
RCONK038 INT,
RCONK039 INT,
RCONK040 INT,
RCONK041 INT,
RCONK042 INT,
RCONK043 INT,
RCONK044 INT,
RCONK045 INT,
RCONK046 INT,
RCONK047 INT,
RCONK048 INT,
RCONK049 INT,
RCONK050 INT,
RCONK051 INT,
RCONK052 INT,
RCONK053 INT,
RCONK054 INT,
RCONK055 INT,
RCONK056 INT,
RCONK057 INT,
RCONK058 INT,
RCONK059 INT,
RCONK060 INT,
RCONK061 INT,
RCONK062 INT,
RCONK063 INT,
RCONK064 INT,
RCONK065 INT,
RCONK066 INT,
RCONK067 INT,
RCONK068 INT,
RCONK069 INT,
RCONK070 INT,
RCONK071 INT,
RCONK087 INT,
RCONK088 INT,
RCONK089 INT,
RCONK102 INT,
RCONK103 INT,
RCONK104 INT,
RCONK105 INT,
RCONK106 INT,
RCONK107 INT,
RCONK108 INT,
RCONK109 INT,
RCONK110 INT,
RCONK111 INT,
RCONK112 INT,
RCONK113 INT,
RCONK114 INT,
RCONK115 INT,
RCONK116 INT,
RCONK117 INT,
RCONK118 INT,
RCONK119 INT,
RCONK120 INT,
RCONK121 INT,
RCONK122 INT,
RCONK123 INT,
RCONK124 INT,
RCONK125 INT,
RCONK126 INT,
RCONK127 INT,
RCONK128 INT,
RCONK130 INT,
RCONK131 INT,
RCONK132 INT,
RCONK138 INT,
RCONK139 INT,
RCONK140 INT,
RCONK213 INT,
RCONK214 INT,
RCONK215 INT,
RCONK216 INT,
RCONK217 INT,
RCONK218 INT,
RCONK257 INT,
RCONK258 INT,
RCONK259 INT,
RCONK274 INT,
RCONK275 INT,
RCONK276 INT,
RCONK277 INT,
RCONK278 INT,
RCONK279 INT,
RCONK280 INT,
RCONK281 INT,
RCONK282 INT,
RCONL183 INT,
RCONL184 INT,
RCONL185 INT,
RCONL186 INT,
RCONL187 INT,
RCONL188 INT,
RIAD0093 INT,
RIAD3196 INT,
RIAD3521 INT,
RIAD4010 INT,
RIAD4012 INT,
RIAD4020 INT,
RIAD4024 INT,
RIAD4056 INT,
RIAD4058 INT,
RIAD4059 INT,
RIAD4060 INT,
RIAD4065 INT,
RIAD4069 INT,
RIAD4070 INT,
RIAD4073 INT,
RIAD4074 INT,
RIAD4079 INT,
RIAD4080 INT,
RIAD4092 INT,
RIAD4093 INT,
RIAD4107 INT,
RIAD4115 INT,
RIAD4135 INT,
RIAD4150 INT,
RIAD4172 INT,
RIAD4180 INT,
RIAD4185 INT,
RIAD4200 INT,
RIAD4217 INT,
RIAD4300 INT,
RIAD4301 INT,
RIAD4302 INT,
RIAD4313 INT,
RIAD4340 INT,
RIAD4435 INT,
RIAD4436 INT,
RIAD4507 INT,
RIAD4508 INT,
RIAD4513 INT,
RIAD4518 INT,
RIAD5415 INT,
RIAD5416 INT,
RIAD8431 INT,
RIAD8757 INT,
RIAD8758 INT,
RIAD8759 INT,
RIAD8760 INT,
RIAD9106 INT,
RIADA220 INT,
RIADA251 INT,
RIADA530 BOOLEAN,
RIADB485 INT,
RIADB486 INT,
RIADB487 INT,
RIADB488 INT,
RIADB489 INT,
RIADB491 INT,
RIADB492 INT,
RIADB493 INT,
RIADB496 INT,
RIADB497 INT,
RIADC216 INT,
RIADC232 INT,
RIADC386 INT,
RIADC387 INT,
RIADC886 INT,
RIADC887 INT,
RIADC888 INT,
RIADC889 INT,
RIADC890 INT,
RIADF186 INT,
RIADF228 INT,
RIADF551 INT,
RIADF552 INT,
RIADF553 INT,
RIADF554 INT,
RIADFT28 INT,
RIADFT36 INT,
RIADFT37 INT,
RIADFT38 INT,
RIADFT39 INT,
RIADFT40 INT,
RIADG103 INT,
RIADG104 INT,
RIADGW44 INT,
RIADH032 INT,
RIADH033 INT,
RIADH034 INT,
RIADH035 INT,
RIADHK03 INT,
RIADHK04 INT,
RIADHT69 INT,
RIADHT70 INT,
RIADHT73 VARCHAR(10),
RIADHT74 INT,
RIADJ321 INT,
RIADJJ33 INT,                                                              
Primary Key(As_Of_DT, ID_RSSD) 
 );

COPY raw_call_data_part_1 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2019(1 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_2 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2019(2 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_1 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2020(1 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_2 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2020(2 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_1 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2021(1 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_2 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2021(2 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_1 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2022(1 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_2 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2022(2 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_1 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2023(1 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');
COPY raw_call_data_part_2 FROM 'FFIEC CDR Call Data/FFIEC CDR Call Subset of Schedules 2023(2 of 2).csv' (FORMAT CSV, HEADER, NULL 'NA');

--Check to see that the data is indeed accessible from both tables
SELECT * FROM raw_call_data_part_1
LIMIT 2;

SELECT * FROM raw_call_data_part_2
LIMIT 5;